# Docker Compose for DB Nexus development, testing, and screenshots
# Provides database instances with sample data

services:
    # PostgreSQL - E-commerce demo database
    postgres-ecommerce:
        image: postgres:16-alpine
        container_name: dbnexus-ecommerce-dev
        environment:
            POSTGRES_USER: demo
            POSTGRES_PASSWORD: demo123
            POSTGRES_DB: ecommerce
        ports:
            - '5450:5432'
        volumes:
            - postgres-ecommerce-data:/var/lib/postgresql/data
            - ./docker/init/ecommerce.sql:/docker-entrypoint-initdb.d/01-init.sql:ro
        healthcheck:
            test: ['CMD-SHELL', 'pg_isready -U demo -d ecommerce']
            interval: 5s
            timeout: 5s
            retries: 5

    # PostgreSQL - Analytics/staging (for schema diff)
    postgres-staging:
        image: postgres:16-alpine
        container_name: dbnexus-ecommerce-staging
        environment:
            POSTGRES_USER: demo
            POSTGRES_PASSWORD: demo123
            POSTGRES_DB: ecommerce_staging
        ports:
            - '5451:5432'
        volumes:
            - postgres-staging-data:/var/lib/postgresql/data
            - ./docker/init/ecommerce-staging.sql:/docker-entrypoint-initdb.d/01-init.sql:ro
        healthcheck:
            test: ['CMD-SHELL', 'pg_isready -U demo -d ecommerce_staging']
            interval: 5s
            timeout: 5s
            retries: 5

    # MySQL - Blog demo database
    mysql-blog:
        image: mysql:8.0
        container_name: dbnexus-blog
        environment:
            MYSQL_ROOT_PASSWORD: root123
            MYSQL_USER: demo
            MYSQL_PASSWORD: demo123
            MYSQL_DATABASE: blog
        ports:
            - '3350:3306'
        volumes:
            - mysql-blog-data:/var/lib/mysql
            - ./docker/init/blog.sql:/docker-entrypoint-initdb.d/01-init.sql:ro
        healthcheck:
            test: ['CMD', 'mysqladmin', 'ping', '-h', 'localhost', '-u', 'demo', '-pdemo123']
            interval: 5s
            timeout: 5s
            retries: 5

volumes:
    postgres-ecommerce-data:
    postgres-staging-data:
    mysql-blog-data:
